fragment CouncilMemberFields on CouncilMember {
  id
  member {
    ...MemberFields
    councilMembers {
      __typename
    }
  }
  unpaidReward
  stake
}

fragment PastCouncilProposalsFields on ProposalVotedEvent {
  voteKind
  voterId
  proposal {
    ...ProposalFields
  }
}

fragment ElectedCouncilFields on ElectedCouncil {
  id
  electedAtBlock
  councilMembers {
    ...CouncilMemberFields
  }
}

fragment PastCouncilFields on ElectedCouncil {
  id
  endedAtBlock
}

fragment PastCouncilDetailedFields on ElectedCouncil {
  ...PastCouncilFields
  councilMembers {
    accumulatedReward
    unpaidReward
  }
}

fragment ElectionCandidateFields on Candidate {
  id
  member {
    ...MemberFields
  }
  stake
  noteMetadata {
    header
    bulletPoints
    bannerImageUri
    description
  }
}

fragment ElectionRoundFields on ElectionRound {
  cycleId
  candidates {
    ...ElectionCandidateFields
  }
}

fragment PastElectionRoundFields on ElectionRound {
  id
  cycleId
  updatedAt
  candidates {
    stake
  }
  castVotes {
    voteForId
  }
}

fragment PastElectionRoundDetailedFields on ElectionRound {
  ...PastElectionRoundFields
  candidates {
    ...ElectionCandidateFields
  }
  castVotes {
    id
    stake
    stakeLocked
    voteForId
    castBy
  }
}

fragment ElectionCandidateDetailedFields on Candidate {
  ...ElectionCandidateFields
  stakingAccountId
  rewardAccountId
  electionRound {
    cycleId
    isFinished
  }
}

fragment CastVoteFields on CastVote {
  id
  stake
  stakeLocked
  castBy
  voteFor {
    ...MemberFields
  }
  electionRound {
    cycleId
  }
}

fragment CouncilSpendingEventFields on BudgetSpendingEvent {
  amount
  type
}

query GetElectedCouncil {
  electedCouncils(where: { endedAtBlock_eq: null }, orderBy: [createdAt_DESC], limit: 1) {
    ...ElectedCouncilFields
  }
}

query GetPastCouncils($offset: Int, $limit: Int, $orderBy: [ElectedCouncilOrderByInput!]) {
  electedCouncils(where: { isResigned_eq: true }, offset: $offset, limit: $limit, orderBy: $orderBy) {
    ...PastCouncilFields
  }
}

query GetPastCouncilsCount {
  electedCouncilsConnection(where: { isResigned_eq: true }) {
    totalCount
  }
}

query GetPastCouncil($id: ID!, $fromBlock: Int!, $toBlock: Int!) {
  electedCouncilByUniqueInput(where: { id: $id }) {
    ...PastCouncilDetailedFields
  }
  budgetSpendingEvents(where: { inBlock_gte: $fromBlock, inBlock_lte: $toBlock }) {
    ...CouncilSpendingEventFields
  }
}

query GetPastCouncilMembers($councilId: ID!, $fromBlock: Int!, $toBlock: Int!) {
  councilMembers(where: { electedInCouncil_eq: $councilId }) {
    member {
      ...MemberFields
    }
  }
  proposalVotedEvents(where: { inBlock_gte: $fromBlock, inBlock_lte: $toBlock }, orderBy: [createdAt_DESC]) {
    ...PastCouncilProposalsFields
  }
}

query GetPastCouncilBudgetSpending($fromBlock: Int!, $toBlock: Int!) {
  budgetSpendingEvents(where: { inBlock_gte: $fromBlock, inBlock_lte: $toBlock }) {
    ...CouncilSpendingEventFields
  }
}

query GetPastCouncilProposals($fromBlock: Int!, $toBlock: Int!) {
  proposals(where: { createdInEvent: { inBlock_gte: $fromBlock, inBlock_lte: $toBlock } }, orderBy: [createdAt_DESC]) {
    ...ProposalFields
  }
}

query GetCurrentElection {
  electionRounds(where: { isFinished_eq: false }, orderBy: [cycleId_DESC], limit: 1) {
    ...ElectionRoundFields
  }
}

query GetPastElections($offset: Int, $limit: Int, $orderBy: [ElectionRoundOrderByInput!]) {
  electionRounds(where: { isFinished_eq: true }, offset: $offset, limit: $limit, orderBy: $orderBy) {
    ...PastElectionRoundFields
  }
}

query GetPastElectionsCount {
  electionRoundsConnection(where: { isFinished_eq: true }) {
    totalCount
  }
}

query GetPastElection($id: ID!) {
  electionRoundByUniqueInput(where: { id: $id }) {
    ...PastElectionRoundDetailedFields
  }
}

query GetCandidate($where: CandidateWhereUniqueInput!) {
  candidateByUniqueInput(where: $where) {
    ...ElectionCandidateDetailedFields
  }
}

query GetElectionCandidatesIds($electionCycleId: Int!) {
  candidates(where: { electionRound: { cycleId_eq: $electionCycleId } }) {
    id
  }
}

query GetCandidateStats($memberId: ID) {
  candidacyWithdrawEventsConnection(where: { member: { id_eq: $memberId } }) {
    totalCount
  }
  councilMembersConnection(where: { member: { id_eq: $memberId } }) {
    totalCount
  }
  candidatesConnection(where: { member: { id_eq: $memberId } }) {
    totalCount
  }
}

query GetCouncilVotes($where: CastVoteWhereInput, $orderBy: [CastVoteOrderByInput!]) {
  castVotes(where: $where, orderBy: $orderBy) {
    ...CastVoteFields
  }
}

query GetCouncilVotesCommitments($where: CastVoteWhereInput, $orderBy: [CastVoteOrderByInput!]) {
  castVotes(where: $where, orderBy: $orderBy) {
    id
    commitment
  }
}

query GetCouncilVotesCount($where: CastVoteWhereInput) {
  castVotesConnection(where: $where) {
    totalCount
  }
}

query GetPastVotesResults($myAccounts: [String!]) {
  electionRounds(where: { isFinished_eq: true, castVotes_some: { castBy_in: $myAccounts } }) {
    id
    electedCouncil {
      councilMembers {
        member {
          id
        }
      }
    }
  }
  castVotes(where: { castBy_in: $myAccounts }) {
    voteFor {
      id
    }
    electionRound {
      id
    }
  }
}

query GetCouncilBlockRange($where: ElectedCouncilWhereUniqueInput!) {
  electedCouncilByUniqueInput(where: $where) {
    electedAtBlock
    endedAtBlock
  }
}

query GetCouncilProposalsStats($startBlock: Int!, $endBlock: Int!) {
  approved: proposalExecutedEventsConnection(where: { inBlock_gt: $startBlock, inBlock_lt: $endBlock }) {
    totalCount
  }
  ## Rejected + Slashed could be fetched using `isTypeOf_in: []` but it is not supported by Hydra now
  rejected: proposalDecisionMadeEventsConnection(
    where: {
      inBlock_gt: $startBlock
      inBlock_lt: $endBlock
      decisionStatus_json: { isTypeOf_eq: "ProposalStatusRejected" }
    }
  ) {
    totalCount
  }
  slashed: proposalDecisionMadeEventsConnection(
    where: {
      inBlock_gt: $startBlock
      inBlock_lt: $endBlock
      decisionStatus_json: { isTypeOf_eq: "ProposalStatusSlashed" }
    }
  ) {
    totalCount
  }
}
